
<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="style/bootstrap.min.css" />
	<link rel="stylesheet" href="style/main-template.css" />

	<script src="js/jquery-1.11.2.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/bootstrap-dropdown.js"></script>	
	<script type="text/javascript" src="web.api.js"></script>
	<script type="text/javascript" src="web.control.js"></script>
	
	<title>Login</title>
	<script>
		
		function IsJsonString(str) {
            try {
                JSON.parse(str);
            } catch (e) {
                return false;
            }
            return true;
        }


        function LoadRootObjects()
        {
            var guids = [ '00000001-0001-0001-0001-000000000001' ];
            api.getObjects(guids, function (result) {

                if (!IsJsonString(result)) {
					alert("Incorrect data format!");
                    return;
                }

                var root = JSON.parse(result)[0];
                var childrenIds = root.Children.Tree;
                api.getObjects(childrenIds, function (children) {
                    OnChildrenLoaded(JSON.parse(children));
                })
                
            })
        }

        function OnChildrenLoaded(children)
        {
			var reference = document.getElementById('spn8');
            for (var i in children) {
                var val = children[i];

                var d = document.createElement('div');
                d.style.height = '30px';
                d.innerText = /*JSON.stringify(val);*/GetTitle(val.Attributes);
                reference.appendChild(d);

            }
        }

        function GetTitle(attributes)
        {
            var result = "";
            for (var i in attributes) {
                var val = attributes[i];
                result = result + val.StrValue;
            }
            return result;
        }

		// возвращает cookie с именем name, если есть, если нет, то undefined
		function getCookie(name) {
		  var results = document.cookie.match ( '(^|;) ?' + name + '=([^;]*)(;|$)' );
		 
		  if ( results )
		    return ( unescape ( results[2] ) );
		  else
		    return null;
		}
		
	</script>
	
</head>
<body>
    <div class="navbar navbar-default navbar-fixed-top" id="mainbrand">
      <div class="navbar-inner">
		<a class="brand" id="brand"></a>
		<p class="navbar-text pull-right" id="inbrand">
			Logged in as <a  class="navbar-link" id="username">Username</a>
		</p>
    </div>
	<div class="container" id="innerframe">
		</div>
			<div class="row-fluid">
			<div class="span8" id="spn8">
									
			</div>
			<div class="span4"></div>
		</div>
	</div>
<script type="text/javascript">
		
		document.getElementById('brand').innerHTML = "Base id: "+getCookie('databaseId');
		document.getElementById('username').innerHTML = getCookie('userName');
		LoadRootObjects();
		
</script>

</body>
</html>
