<!DOCTYPE html>
<html>
<head>

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="style/bootstrap.min1.css" />
	<link rel="stylesheet" href="style/main-template.css" />
    <link type="text/css" href="style/style.css" rel="stylesheet" />
	
	<script src="js/jquery-1.11.2.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/bootstrap-dropdown.js"></script>	
	<script type="text/javascript" src="web.api.js"></script>
	<script type="text/javascript" src="web.control.js"></script>
	
	<title>Mainframe</title>
	<script>
		
		function IsJsonString(str) {
            try {
                JSON.parse(str);
            } catch (e) {
                return false;
            }
            return true;
        }


        function LoadRootObjects()
        {
            var guids = [ '00000001-0001-0001-0001-000000000001' ];
            api.getObjects(guids, function (result) {

                if (!IsJsonString(result)) {
					alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö");
                    return;
                }

                var root = JSON.parse(result)[0];
				
				// —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤–æ–π "–∫—Ä–æ—à–∫–∏"
				var partOfRootBreadCrumbId = 'root';
				var rootBreadCrumbLabel = '–ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞';
							
				// –∏–∑–º–µ–Ω–µ–Ω–∏–µ url
				history.pushState(null, null, "?id=" + root.Id);
				
				createBreadCrumb('navigation', partOfRootBreadCrumbId, '#');
				addBreadCrumbContent(partOfRootBreadCrumbId, rootBreadCrumbLabel, root.Id);
				addBreadCrumbEventListener(partOfRootBreadCrumbId);
				
                var childrenIds = root.Children.Tree;
                api.getObjects(childrenIds, function (children) {

					api.getMetadata(function(result){
						
						if (!IsJsonString(result)) {
							alert("Incorrect data format!");
							return;
						}
				
						window.meta = JSON.parse(result);
					}, errorGetMetaData);
				
                    OnChildrenLoaded(JSON.parse(children));
                }, errorGetObjects)
                
            }, errorGetObjects
			)
        }

		
        function OnChildrenLoaded(children)
        {
			var count = 100500;
			var text;
			var chil;
			var typeId;
            var val;
			var size;
			var hasFiles;
			var idFiles;
			var modified;
			var nameFiles;
			
            for (var i in children) {
				val = children[i];
				typeId = children[i].TypeId;
				count = (children[i].Children.Tree).length;
				text = GetTitle(val.Attributes);	
				var root = window.meta;
				for (var j in root.Types) {
					if (root.Types[j].Id == typeId) {
						icon = root.Types[j].Icon;
						hasFiles = root.Types[j].HasFiles;
						if(hasFiles){
							idFiles = children[i].Files[0].Body.Id;
							size = children[i].Files[0].Body.Size;
							nameFiles = children[i].Files[0].Name;
							modified = children[i].Files[0].Body.Modified;
						}
					}
					
				}
				createItem('content', i, 'data:image/svg+xml;base64,' + icon );
				addFolderEventListener(i);
				addInnerFolderContent(i, count, text, children[i].Id , hasFiles, idFiles, size, nameFiles, modified);
            }
        }

        function GetTitle(attributes)
        {
            var result = '';
			var name = '';
			var customer = '';
			var project_name = '';
			var code = '';
			
			for (var i in attributes) {
				if (i == 'name') {
					if(name != null)
						name = attributes[i].StrValue;
				}
				if (i == 'project_name') {
					if(project_name != null)
						project_name = attributes[i].StrValue;
				}
				if (i == 'code') {
					if(code != null)
						code = attributes[i].StrValue;
				}
			}
			result = code + " " + name + " " + project_name ;
            return result;
        }

		// ‚ÓÁ‚‡˘‡ÂÚ cookie Ò ËÏÂÌÂÏ name, ÂÒÎË ÂÒÚ¸, ÂÒÎË ÌÂÚ, ÚÓ undefined
		function getCookie(name) {
		  var results = document.cookie.match ( '(^|;) ?' + name + '=([^;]*)(;|$)' );
		 
		  if ( results )
		    return ( unescape ( results[2] ) );
		  else
		    return null;
		}
		
		
		function mouseenterVisible(event){
		
			var myId = {};
			if(!tryGetId(event, myId)){
				alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞');
				return;
			}
			var div = document.getElementById(myId.id);
			var elems = div.getElementsByTagName('input');
			for(var i=0; i<elems.length; i++) 
				document.getElementById(elems[i].id).style.visibility = "visible";
			return true;
		}
		
		function mouseleaveVisible(event){
		
			var myId ={};
			if(!tryGetId(event, myId)){
				alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞');
				return;
			}
			var div = document.getElementById(myId.id);
			var elems = div.getElementsByTagName('input');
			
			for(var i=0; i<elems.length; i++) {
				if(document.getElementById(elems[i].id).checked)
					document.getElementById(elems[i].id).style.visibility = "visible";	
				else
					document.getElementById(elems[i].id).style.visibility = "hidden";			
			}
		}

		function mouseClickFolderLink(){
		
			// –ø–æ–ª—É—á–µ–Ω–∏–µ id —ç–ª–µ–º–µ–Ω—Ç–∞, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–≤—à–µ–≥–æ —Å–æ–±—ã—Ç–∏–µ
			var myId ={};
			if(!tryGetId(event, myId)){
				alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞');
				return;
			}
			
			// –ø–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Å—Ç–∏ id, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è id folder, —Å–æ–¥–µ—Ä–∂–∞—â–µ–π ids
			var id = {};
			if(!tryFindPartId(myId.id, id)){
				alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞');
				return;
			}			

			var testChildren = document.getElementById('childrenCount-' + id.partId).innerHTML;
			var testHasFiles = document.getElementById('folder-' + id.partId).dataset.hasfiles;

			if(testChildren != 0 && testHasFiles != true){
			// –ø–æ–ª—É—á–µ–Ω–∏–µ ids	
				var ids = document.getElementById('folder-' + id.partId).dataset.ids;
				
			// –∏–∑–º–µ–Ω–µ–Ω–∏–µ url
				history.pushState(null, null, "?id=" + ids);
			
			//	–ø–æ–ª—É—á–µ–Ω–∏–µ road			
				var div = document.getElementById('navigation');
				var elems = div.getElementsByTagName('LI');
				var liLength = elems.length - 1;
				var elemslinks = elems[liLength].getElementsByTagName('A');
				var aLength = elemslinks.length - 1;
				var road = elemslinks[aLength].dataset.road;

			// —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è "–∫—Ä–æ—à–∫–∏"
				var breadCrumbLabel = document.getElementById('folderLinkTextp-' + id.partId).innerHTML;
			// —Å–º–µ–Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞	
				document.title = breadCrumbLabel;
				
				if(!createBreadCrumb('navigation', road + '' + id.partId, '#')){
					alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ ');
					return;
				}else{
					if(!addBreadCrumbContent(road + '' + id.partId, breadCrumbLabel, ids)){
						alert('–ù–µ—É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ ');
						return;
					}else{
						addBreadCrumbEventListener(road + '' + id.partId);
						LoadFolderContent(ids);		
					}
				}
			} else{
			/*
				// –ø–æ–ª—É—á–µ–Ω–∏–µ idFiles	
				var idFiles = document.getElementById('folder-' + id.partId).dataset.idfiles;
							
				// –ø–æ–ª—É—á–µ–Ω–∏–µ sizeFiles	
				var sizeFiles = document.getElementById('folder-' + id.partId).dataset.sizefiles;

				// –ø–æ–ª—É—á–µ–Ω–∏–µ nameFiles	
				var namefiles = document.getElementById('folder-' + id.partId).dataset.namefiles;
				
				//alert(api.openFile(idFiles, sizeFiles, namefiles));
				SaveToDisk2(api.openFile(idFiles, sizeFiles, namefiles, function(result){	
						alert('here!');
				}, errorGetFile), namefiles);
			*/
			//alert('–≠—Ç–æ —Ñ–∞–π–ª');
			}
		
		}
		
		function errorGetObjects() {
			alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç");
		}
		
		function errorGetMetaData() {
			alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ");
		}
		
		function errorGetFile() {
			alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª");
		}
		
		function LoadFolderContent(ids){
					
		// –æ—á–∏—Å—Ç–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ content
			document.getElementById("content").innerText = '';

			document.getElementById('downloadButton').style.visibility = "hidden";
		
			ids = [ ids ];
            api.getObjects(ids, function (result) {

				if (!IsJsonString(result)) {
					alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö");
					return;
				}

				var newFolder = JSON.parse(result)[0];
				var childrenIds = newFolder.Children.Tree;
				api.getObjects(childrenIds, function (children) {
					OnChildrenLoaded(JSON.parse(children));
				},errorGetObjects)
  
            }, errorGetObjects);
		
		}
		
		
		function tryFindPartId(str, result){
		
			try{
				var start = str.indexOf('-');
				result.partId = str.substring(start + 1, str.length);
				return true;
			} catch(e){
				return false;
			}
		
		}
		
		function mouseClickBreadCrumb(event){
			
			window.flag = false;
			
			var myId = {};
			if(!tryGetId(event, myId)){
				alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å id —ç–ª–µ–º–µ–Ω—Ç–∞');
				return;
			}
			// —Å–º–µ–Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞	
			document.title = document.getElementById(myId.id).innerText;
			
			// –ø–æ–ª—É—á–µ–Ω–∏–µ ids	
			var ids = document.getElementById(myId.id).dataset.ids;			
			
			// –∏–∑–º–µ–Ω–µ–Ω–∏–µ url
			history.pushState(null, null, "?id=" + ids);
			
			//	–ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å–ø–∏—Å–∫–∞			
			var div = document.getElementById('navigation');

			var length = document.getElementById('navigation').getElementsByTagName('li').length;			
			var road = document.getElementById(myId.id).dataset.road;
			var count = (road.split('*').length - 1);
			
			for(var i=count-1; i<length-1; i++){
				var idRemovingElement = document.getElementById('navigation').lastElementChild.id;
				var removingElement = document.getElementById(idRemovingElement);
				div.removeChild(removingElement);
			}

			LoadFolderContent(ids);	
		}
		
		function tryGetId(event, myId){
			try{
				event = event || window.event;
				// –¢–µ–ø–µ—Ä—å event - –æ–±—ä–µ–∫—Ç —Å–æ–±—ã—Ç–∏—è –≤–æ –≤—Å–µ—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö.
				var sender = event.srcElement || event.target;
				myId.id = sender.id;
				return true;
			}catch(e){
				return false; 
			}
		}
		
		function createElement( name, attributes ) {
		    var el = document.createElement( name );
		    if ( typeof attributes == 'object' ) {
				for ( var i in attributes ) {
					el.setAttribute( i, attributes[i] );

					if ( i.toLowerCase() == 'class' ) {
						el.className = attributes[i];  
					} else if ( i.toLowerCase() == 'src' ) {
						el.src = attributes[i]; 
					} else if ( i.toLowerCase() == 'href' ) {
						el.href = attributes[i]; 
					} else if ( i.toLowerCase() == 'alt' ) {
						el.alt = attributes[i]; 
					} else if ( i.toLowerCase() == 'type' ) {
						el.type = attributes[i]; 
					}
				}
			}
			for ( var i = 2; i<arguments.length; i++ ) {
				var val = arguments[i];
				if ( typeof val == 'string' ) { val = document.createTextNode( val ) };
				el.appendChild( val );
			}
			return el;
		}
		
		function createBreadCrumb(parentId, i, ihref){
		
			var holder = document.getElementById( parentId );
			if( holder != null ){
			var list;
				try{
					holder.appendChild( 
						list = 
							createElement( "li", {id: 'breadcrumb-'+i}, 
								createElement( "a", {id: 'link-'+i, class: 'link', href: ihref} )
							)
					);
				}catch(e){
					alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏');
				}
				return true;
			}else
				return false;
			
		}
		
		function addBreadCrumbContent(i, content, ids){
	
			try{
				document.getElementById('link-' + i).innerHTML = content;
				document.getElementById('link-' + i).dataset.ids = ids;
				document.getElementById('link-' + i).dataset.road =  i + '*';	//*	
				return true;
			}catch(e){
				return false;
			}	
		
		}
		
		function addBreadCrumbEventListener(i){
		
			try{
				document.getElementById('link-' + i).addEventListener("click", mouseClickBreadCrumb);
				return true;
			}catch(e){
				return false;
			}
		}
		
		
		function createItem(parentId, i, isrc){
		
			var holder = document.getElementById( parentId );
			if( holder != null ){
				var folder;
				var img, div, input, label;
				try{
					holder.appendChild( 
						folder = 
							createElement( "div", {id: 'folder-'+i, class: 'folder'}, 
								createElement( "a", {id: 'folderLink-'+i, class: 'folderLink' },
									createElement( "div", {id: 'folderLinkImg-'+i, class: 'folderLinkImg'}, 
										createElement( "div", { id: 'childrenCount-'+i, class: 'childrenCount' }
										),
										img = 
										createElement( "img", {id: 'folderLinkImgIcon-'+i, src: isrc, alt: ''}
										)				
									),
									div = 
									createElement( "div", {id: 'folderLinkText-'+i, class: 'folderLinkText'},
										createElement( "p", {id: 'folderLinkTextp-'+i}
										)
									)
								),		
								input = 
								createElement( "input", {id: 'input-'+i, type: 'checkbox' }														
								)			
							)
					);
				}catch(e){
					alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç');
				}
			}else
				return false;
		}
		
		function addFolderEventListener(i){
		
			try{
				document.getElementById('folder-' + i).addEventListener("mouseenter", mouseenterVisible);
				document.getElementById('folder-' + i).addEventListener("mouseleave", mouseleaveVisible);
				document.getElementById('folderLink-' + i).addEventListener("click", mouseClickFolderLink);
				document.getElementById('input-' + i).addEventListener("change", checkboxChange);
				
				
				return true;
			}catch(e){
				return false;
			}
		}
		
		function addInnerFolderContent( i, childrenCount, folderLinkTextp, ids, hasFiles, idFiles, sizeFiles, nameFiles, modified){

			try{
				document.getElementById('childrenCount-' + i).innerHTML = childrenCount;
				document.getElementById('folderLinkTextp-' + i).innerHTML = folderLinkTextp;
				document.getElementById('folder-' + i).dataset.ids = ''+ids+'';
				document.getElementById('folder-' + i).dataset.hasfiles = hasFiles;

				if(hasFiles){	
					document.getElementById('folder-' + i).dataset.idfiles = idFiles;
					document.getElementById('folder-' + i).dataset.sizefiles = sizeFiles;
					document.getElementById('folder-' + i).dataset.namefiles = nameFiles;
					document.getElementById('folder-' + i).dataset.modified = modified;
					
				}
				return true;
			}catch(e){
				return false;
			}		
		}
	
		function checkboxChange(event){
			
			// –ø–æ–ª—É—á–µ–Ω–∏–µ id —ç–ª–µ–º–µ–Ω—Ç–∞, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–≤—à–µ–≥–æ —Å–æ–±—ã—Ç–∏–µ
			var myId ={};
			if(!tryGetId(event, myId)){
				alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å id —ç–ª–µ–º–µ–Ω—Ç–∞');
				return;
			}

			// –ø–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Å—Ç–∏ id, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è id folder, —Å–æ–¥–µ—Ä–∂–∞—â–µ–π ids
			var id = {};
			if(!tryFindPartId(myId.id, id)){
				alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ id —ç–ª–µ–º–µ–Ω—Ç–∞');
				return;
			}			
			
			if(document.getElementById(myId.id).checked){
			
				
				window.downloadfile = {};
				window.downloadfile.objectId = 'folder-' + id.partId;

				window.downloadfile.objectHasFiles = document.getElementById(window.downloadfile.objectId).dataset.hasfiles;
				var testChildren = document.getElementById('childrenCount-' + id.partId).innerHTML;
				
				if(window.downloadfile.objectHasFiles){
					if(testChildren == 0){
						window.downloadfile.fileId = document.getElementById(window.downloadfile.objectId).dataset.idfiles;
						window.downloadfile.fileSize = document.getElementById(window.downloadfile.objectId).dataset.sizefiles;
						window.downloadfile.fileName = document.getElementById(window.downloadfile.objectId).dataset.namefiles;
						window.downloadfile.modified = document.getElementById(window.downloadfile.objectId).dataset.modified;
						
						document.getElementById('downloadButton').style.visibility = "visible";
						
						document.getElementById('modal-body-name').innerHTML = '–ò–º—è —Ñ–∞–π–ª–∞, –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∏–∑ –±–∞–∑—ã: "' + window.downloadfile.fileName + '"';
						document.getElementById('modal-body-size').innerHTML = '–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: ' + window.downloadfile.fileSize;
						document.getElementById('modal-body-modified').innerHTML = '–ò–∑–º–µ–Ω—ë–Ω: ' + window.downloadfile.modified;
						var elem = document.getElementById('downloadname');
						elem.placeholder = window.downloadfile.fileName;
					
				}else
					alert("–í—ã–±—Ä–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª–æ–≤");
				
				}else
					alert("–í—ã–±—Ä–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª–æ–≤");
				
			}
			else
				document.getElementById('downloadButton').style.visibility = "hidden";			
		}
		
	function download(){
	
		if(downloadFile()){
		// –∑–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
			$('#myModal').modal('hide');
			document.getElementById('modal-name').innerHTML = '';
			
		}else{
			alert('–ù–µ –º–æ–≥—É –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
		}
	}		
	
	function downloadFile(){
	
		try{
			var fileURL = api.openFile(window.downloadfile.fileId, window.downloadfile.fileSize, window.downloadfile.fileName, function(result){
				}, errorGetFile);
			var fileName = document.getElementById('downloadname').value;
			SaveToDisk1(fileURL, fileName);
			return true;
		}catch(e){
			return false;
		}		
	}
	
	function SaveToDisk1(fileURL, fileName) {
    // for non-IE
    if (!window.ActiveXObject) {
        var save = document.createElement('a');
        save.href = fileURL;
        save.target = '_blank';
        save.download = fileName || 'unknown';

        var event = document.createEvent('Event');
        event.initEvent('click', true, true);
        save.dispatchEvent(event);
        (window.URL || window.webkitURL).revokeObjectURL(save.href);
		}

		// for IE
		else if ( !! window.ActiveXObject && document.execCommand)     {
			var _window = window.open(fileURL, '_blank');
			_window.document.close();
			_window.document.execCommand('SaveAs', true, fileName || fileURL)
			_window.close();
		}
	}


	function SaveToDisk2(fileURL, fileName) {
		// for non-IE
		if (!window.ActiveXObject) {

			var save = document.createElement('a');
			save.href = fileURL;
			save.target = '_blank';
			save.download = fileName || fileURL;
			var evt = document.createEvent('MouseEvents');
			evt.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0,
				false, false, false, false, 0, null);
			save.dispatchEvent(evt);
			(window.URL || window.webkitURL).revokeObjectURL(save.href);
		}

		// for IE
		else if ( !! window.ActiveXObject && document.execCommand)     {

			var _window = window.open(fileURL, "_blank");
			_window.document.close();
			_window.document.execCommand('SaveAs', true, fileName || fileURL)
			_window.close();
		}
	}
		
	function attempt(){
		if(document.getElementById("downloadname").value != '')
			document.getElementById('download').disabled = false;
		else
			document.getElementById('download').disabled = true;
	}
	
	function whichButton(event)
	{
		if(event.keyCode == 13 && document.getElementById('download').disabled == false)
			download();
	}
	</script>

</head>
<body>

	<div class="navbar navbar-default" id="mainbrand">
		<div class="navbar-inner">
			<p class="navbar-text pull-left" id="inbrand1">
				–ò–º—è –±–∞–∑—ã : <a  class="navbar-link" id="basename"></a>   
			</p>
			<p class="navbar-text pull-left" id="inbrand1">
				–í–µ—Ä—Å–∏—è –±–∞–∑—ã : <a  class="navbar-link" id="baseversion"></a>
			</p>
			<p class="navbar-text pull-right" id="inbrand2">
				–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å : <a  class="navbar-link" id="username"></a>
			</p>	
			<!-- Button trigger modal -->
			<button class="btn btn-lg pull-center" id="downloadButton" data-toggle="modal" data-target="#myModal">
					–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
			</button>
		</div>
	</div>	
	<div id="header">

		<!-- Modal -->
		<div class="modal fade" align="center" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" onkeyup="whichButton(event)">
		  <div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" id="close" data-dismiss="modal" aria-hidden="true">√ó</button>
					<h4 class="modal-title" id="myModalLabel">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h4>
				</div>
				<div class="modal-body" align="left">
					<p class="modal-body-text">
					–§–∞–π–ª –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –∫–∞—Ç–∞–ª–æ–≥, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.
					–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.
					</p>
					<input class="modal-name" placeholder="–ò–º—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ " required="required" autofocus="" onkeyup="attempt()" type="inputname" id="downloadname">
					<p class="modal-body-name" id="modal-body-name" ></p>
					<p class="modal-body-size" id="modal-body-modified"></p>
					<p class="modal-body-size" id="modal-body-size"></p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
					<button type="button" class="btn btn-success" onclick="download()" disabled id="download">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</button>
				</div>
			</div>
		  </div>
		</div>

	</div>
		<ol class="breadcrumb" id="navigation">
		</ol>
		<div class="main" id="main">
			<div class="content foldersContent" id="content">
			</div>
			<div class="clearfix"></div>
			<div class="content documentsContent"></div>
			<div class="clearfix"></div>
		</div>
	<div class="clear"></div>
<script type="text/javascript">
	
	document.getElementById('basename').innerHTML = getCookie('baseName');
	document.getElementById('baseversion').innerHTML = getCookie('databaseVersion');
	document.getElementById('username').innerHTML = getCookie('userName');
	api.currentHost = getCookie('nginxHost');
	
	// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è "popstate": 
	window.addEventListener('popstate', function(event) { 
	if(window.flag){
		//	–ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å–ø–∏—Å–∫–∞			
		var div = document.getElementById('navigation');
		var length = document.getElementById('navigation').getElementsByTagName('li').length;
		
		if(length>1){
			var idRemovingElement = document.getElementById('navigation').lastElementChild.id;
			var removingElement = document.getElementById(idRemovingElement);
			div.removeChild(removingElement);
			var idNewLastElement = document.getElementById('navigation').lastElementChild.id;
			var partOflinkIntoBreadCrumbid = {};
			
			if(!tryFindPartId(idNewLastElement, partOflinkIntoBreadCrumbid)){
				alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ id —ç–ª–µ–º–µ–Ω—Ç–∞');
				return;
			}				
			// –ø–æ–ª—É—á–µ–Ω–∏–µ ids	
			var ids = document.getElementById('link-' + partOflinkIntoBreadCrumbid.partId).dataset.ids;	
			// —Å–º–µ–Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞	
			document.title = document.getElementById('link-' + partOflinkIntoBreadCrumbid.partId).innerText;
			
			LoadFolderContent(ids);
		}else{
			var ids = document.getElementById('link-root').dataset.ids;	
			// –∏–∑–º–µ–Ω–µ–Ω–∏–µ url
			history.pushState(null, null, "?id=" + ids);
		}
    }
	window.flag = true;
	},  false); 
	
	LoadRootObjects();
	window.flag = true;
	document.getElementById('downloadButton').style.visibility = "hidden";
</script>

</body>
</html>
